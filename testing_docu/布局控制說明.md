# Windows Forms 布局控制說明

## 本項目使用的布局方式

### 1. **Dock（停靠布局）**
控件會停靠在父容器的邊緣，填滿可用空間。

```csharp
// 示例：停靠在頂部
configGroupBox.Dock = DockStyle.Top;  // 停靠在頂部
manualImagePanel.Dock = DockStyle.Fill;  // 填滿父容器
```

**常用值：**
- `DockStyle.Top` - 停靠在頂部
- `DockStyle.Bottom` - 停靠在底部
- `DockStyle.Left` - 停靠在左側
- `DockStyle.Right` - 停靠在右側
- `DockStyle.Fill` - 填滿整個父容器
- `DockStyle.None` - 不使用停靠（使用位置和大小）

**在項目中的使用：**
- `configGroupBox.Dock = DockStyle.Top` - 配置區域在頂部
- `buttonPanel.Dock = DockStyle.Top` - 按鈕區域在配置區域下方
- `mainContentPanel.Dock = DockStyle.Fill` - 主內容區域填滿剩餘空間

---

### 2. **TableLayoutPanel（表格布局）**
類似 HTML 的 `<table>`，將控件排列在網格中。

```csharp
var configTable = new TableLayoutPanel
{
    Dock = DockStyle.Fill,
    ColumnCount = 2,  // 2 列
    RowCount = 4      // 4 行
};

// 設置列寬度（百分比）
configTable.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 50F));  // 第一列 50%
configTable.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 50F)); // 第二列 50%

// 設置行高度（自動大小）
configTable.RowStyles.Add(new RowStyle(SizeType.AutoSize));  // 自動高度

// 添加控件到指定位置 (列, 行)
configTable.Controls.Add(modelPanel, 0, 0);  // 第 0 列，第 0 行
configTable.Controls.Add(watchPanel, 1, 0);   // 第 1 列，第 0 行

// 跨列
configTable.SetColumnSpan(manualImagePanel, 2);  // 跨 2 列
```

**SizeType 類型：**
- `SizeType.AutoSize` - 根據內容自動調整大小
- `SizeType.Percent` - 按百分比分配空間（如 50F = 50%）
- `SizeType.Absolute` - 固定像素大小（如 300F = 300 像素）

**在項目中的使用：**
- `configTable` - 配置區域的 2x4 網格
- `mainContentPanel` - 主內容區域的 3 列布局（圖片 | 分隔線 | 信息）
- `infoPanel` - 信息面板的 3 行布局（統計 | 進度 | 日誌）

---

### 3. **FlowLayoutPanel（流式布局）**
控件按順序排列，自動換行。

```csharp
var modelPanel = new FlowLayoutPanel 
{ 
    Dock = DockStyle.Fill,
    FlowDirection = FlowDirection.LeftToRight,  // 從左到右排列
    Margin = new Padding(0, 5, 0, 5),          // 外邊距
    WrapContents = false                        // 不換行
};

modelPanel.Controls.Add(label);
modelPanel.Controls.Add(textBox);
modelPanel.Controls.Add(button);
```

**FlowDirection：**
- `FlowDirection.LeftToRight` - 從左到右
- `FlowDirection.TopDown` - 從上到下

**在項目中的使用：**
- `modelPanel` - 模型文件選擇行（標籤 + 文本框 + 按鈕）
- `buttonPanel` - 按鈕區域（多個按鈕水平排列）
- `paramPanel` - 參數設置區域（TrackBar 和 Label 水平排列）

---

### 4. **Anchor（錨定）**
控件相對於父容器的邊緣保持固定距離。

```csharp
browseModelButton.Anchor = AnchorStyles.Left;  // 固定在左側
```

**常用組合：**
- `AnchorStyles.Left` - 固定在左側
- `AnchorStyles.Right` - 固定在右側
- `AnchorStyles.Top` - 固定在上方
- `AnchorStyles.Bottom` - 固定在下方
- `AnchorStyles.Left | AnchorStyles.Right` - 左右拉伸
- `AnchorStyles.Top | AnchorStyles.Bottom` - 上下拉伸

**在項目中的使用：**
- 瀏覽按鈕使用 `AnchorStyles.Left` 保持左對齊

---

### 5. **Margin 和 Padding（邊距）**

**Margin（外邊距）** - 控件與其他控件之間的距離
```csharp
Margin = new Padding(0, 5, 0, 5)  // 左, 上, 右, 下
```

**Padding（內邊距）** - 控件內部內容與邊緣的距離
```csharp
Padding = new Padding(10)  // 所有方向 10 像素
```

---

### 6. **Width 和 Height（固定大小）**

```csharp
Button { Width = 120, Height = 35 }  // 固定寬度和高度
TextBox { Width = 300 }              // 固定寬度
```

---

## 布局層級結構

```
MainForm (Form)
├── configGroupBox (GroupBox, Dock=Top, Height=250)
│   └── configTable (TableLayoutPanel, Dock=Fill, 2列x4行)
│       ├── Row 0: [modelPanel, watchPanel]
│       ├── Row 1: [outputPanel, modePanel]
│       ├── Row 2: [manualImagePanel (跨2列)]
│       │   └── manualImageTable (TableLayoutPanel, 1列x2行)
│       │       ├── Row 0: singleFilePanel (FlowLayoutPanel)
│       │       └── Row 1: batchFilePanel (FlowLayoutPanel)
│       └── Row 3: [paramPanel (跨2列)]
│
├── buttonPanel (FlowLayoutPanel, Dock=Top, Height=50)
│   └── [多個按鈕水平排列]
│
├── mainContentPanel (TableLayoutPanel, Dock=Fill, 3列x1行)
│   ├── Column 0: imagePreviewGroupBox (GroupBox, 百分比寬度)
│   ├── Column 1: splitter (Panel, 5像素寬)
│   └── Column 2: infoPanel (TableLayoutPanel, 300像素寬)
│       ├── Row 0: statisticsGroupBox (AutoSize)
│       ├── Row 1: progressGroupBox (AutoSize)
│       └── Row 2: logGroupBox (百分比高度)
│
└── statusStrip (StatusStrip, Dock=Bottom)
```

---

## 常見布局問題和解決方案

### 問題 1：控件不顯示
**原因：** `TableLayoutPanel` 沒有設置 `RowStyles` 或 `ColumnStyles`
**解決：** 為每一行/列添加 `RowStyle` 或 `ColumnStyle`

```csharp
// ❌ 錯誤：沒有設置 RowStyles
var table = new TableLayoutPanel { RowCount = 2 };

// ✅ 正確：設置 RowStyles
var table = new TableLayoutPanel { RowCount = 2 };
table.RowStyles.Add(new RowStyle(SizeType.AutoSize));
table.RowStyles.Add(new RowStyle(SizeType.AutoSize));
```

### 問題 2：FlowLayoutPanel 中的控件不顯示
**原因：** 在 `FlowLayoutPanel` 中使用 `Dock = DockStyle.Fill` 可能無效
**解決：** 使用 `AutoSize = true` 或設置固定 `Width`

```csharp
// ❌ 可能不工作
var panel = new FlowLayoutPanel { Dock = DockStyle.Fill };

// ✅ 正確
var panel = new FlowLayoutPanel { AutoSize = true };
// 或
var textBox = new TextBox { Width = 300 };  // 設置固定寬度
```

### 問題 3：控件被裁剪
**原因：** 父容器高度固定，內容超出
**解決：** 增加父容器高度或使用 `AutoSize`

```csharp
// 動態調整高度
configGroupBox.Height = 320;  // 增加高度
```

### 問題 4：布局不更新
**原因：** 修改屬性後沒有強制刷新
**解決：** 調用 `Invalidate()`, `Update()`, `PerformLayout()`

```csharp
control.Visible = true;
control.Parent.Invalidate();
control.Parent.Update();
control.Parent.PerformLayout();
```

---

## 修改布局的步驟

1. **確定要修改的控件位置**
   - 找到控件在布局層級中的位置
   - 查看父容器的布局類型

2. **修改布局屬性**
   - 調整 `Dock`, `Anchor`, `Width`, `Height`
   - 修改 `TableLayoutPanel` 的 `RowStyles`/`ColumnStyles`
   - 調整 `Margin` 和 `Padding`

3. **強制刷新**
   - 調用 `Invalidate()`, `Update()`, `PerformLayout()`
   - 如果是 `TableLayoutPanel`，確保所有行/列都有對應的 Style

4. **測試**
   - 運行程序檢查效果
   - 調整窗口大小測試響應式布局

---

## 本項目的布局特點

1. **響應式設計**
   - 主內容區域使用百分比寬度，適應不同窗口大小
   - 信息面板固定 300 像素寬度

2. **動態高度調整**
   - `configGroupBox` 根據模式切換動態調整高度（250 → 320）

3. **自動布局**
   - 大部分行使用 `AutoSize`，根據內容自動調整
   - 減少手動計算大小的需要

4. **嵌套布局**
   - 多層 `TableLayoutPanel` 和 `FlowLayoutPanel` 組合
   - 實現複雜的網格和流式布局
