<Window x:Class="IndustrySegSys.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:IndustrySegSys"
        xmlns:skia="clr-namespace:SkiaSharp.Views.WPF;assembly=SkiaSharp.Views.WPF"
        mc:Ignorable="d"
        Title="工業檢測系統 - 自動監控模式" Height="900" Width="1400"
        Background="#F0F0F0" Closing="WindowClosing">
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 顶部配置区域 -->
        <GroupBox Grid.Row="0" Header="配置" Margin="0,0,0,10" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 模型文件选择 -->
                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,5">
                    <Label Content="模型文件:" Width="100" VerticalAlignment="Center"/>
                    <TextBox x:Name="ModelPathTextBox" Width="300" VerticalAlignment="Center" IsReadOnly="True"/>
                    <Button x:Name="BrowseModelButton" Content="浏览..." Width="80" Margin="5,0,0,0" Click="BrowseModelButton_Click"/>
                </StackPanel>

                <!-- 監控目錄選擇 -->
                <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="0,5">
                    <Label Content="監控目錄:" Width="100" VerticalAlignment="Center"/>
                    <TextBox x:Name="WatchPathTextBox" Width="300" VerticalAlignment="Center" IsReadOnly="True"/>
                    <Button x:Name="BrowseWatchPathButton" Content="浏览..." Width="80" Margin="5,0,0,0" Click="BrowseWatchPathButton_Click"/>
                </StackPanel>

                <!-- 输出目录选择 -->
                <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,5">
                    <Label Content="输出目录:" Width="100" VerticalAlignment="Center"/>
                    <TextBox x:Name="OutputPathTextBox" Width="300" VerticalAlignment="Center" IsReadOnly="True"/>
                    <Button x:Name="BrowseOutputButton" Content="浏览..." Width="80" Margin="5,0,0,0" Click="BrowseOutputButton_Click"/>
                </StackPanel>

                <!-- 工作模式 -->
                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,5">
                    <Label Content="工作模式:" Width="100" VerticalAlignment="Center"/>
                    <RadioButton x:Name="MonitorModeRadio" Content="自動監控模式" IsChecked="True" VerticalAlignment="Center" Margin="5,0" Checked="MonitorModeRadio_Checked"/>
                    <RadioButton x:Name="ManualModeRadio" Content="手動處理模式" VerticalAlignment="Center" Margin="5,0" Checked="ManualModeRadio_Checked"/>
                </StackPanel>

                <!-- 手動模式：圖片文件/目錄選擇 -->
                <StackPanel x:Name="ManualImagePanel" Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,5" Visibility="Collapsed">
                    <Label Content="圖片路徑:" Width="100" VerticalAlignment="Center"/>
                    <TextBox x:Name="ImagePathTextBox" Width="300" VerticalAlignment="Center" IsReadOnly="True"/>
                    <Button x:Name="BrowseImageButton" Content="浏览..." Width="80" Margin="5,0,0,0" Click="BrowseImageButton_Click"/>
                    <Label Content="處理模式:" Width="100" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    <RadioButton x:Name="SingleFileRadio" Content="單文件" IsChecked="True" VerticalAlignment="Center" Margin="5,0" Checked="SingleFileRadio_Checked"/>
                    <RadioButton x:Name="BatchFileRadio" Content="批量處理" VerticalAlignment="Center" Margin="5,0" Checked="BatchFileRadio_Checked"/>
                </StackPanel>

                <!-- 参数设置 -->
                <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,10,0,0">
                    <Label Content="Confidence:" Width="100" VerticalAlignment="Center"/>
                    <Slider x:Name="ConfidenceSlider" Minimum="0.1" Maximum="1.0" Value="0.24" Width="150" VerticalAlignment="Center" ValueChanged="ConfidenceSlider_ValueChanged"/>
                    <TextBlock x:Name="ConfidenceValue" Text="0.24" Width="50" VerticalAlignment="Center" Margin="5,0"/>

                    <Label Content="Pixel Confidence:" Width="120" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    <Slider x:Name="PixelConfidenceSlider" Minimum="0.1" Maximum="1.0" Value="0.5" Width="150" VerticalAlignment="Center" ValueChanged="PixelConfidenceSlider_ValueChanged"/>
                    <TextBlock x:Name="PixelConfidenceValue" Text="0.5" Width="50" VerticalAlignment="Center" Margin="5,0"/>

                    <Label Content="IoU:" Width="50" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    <Slider x:Name="IouSlider" Minimum="0.1" Maximum="1.0" Value="0.7" Width="150" VerticalAlignment="Center" ValueChanged="IouSlider_ValueChanged"/>
                    <TextBlock x:Name="IouValue" Text="0.7" Width="50" VerticalAlignment="Center" Margin="5,0"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- 控制按钮区域 -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
            <Button x:Name="StartMonitorButton" Content="開始監控" Width="120" Height="35" FontSize="14" Click="StartMonitorButton_Click" IsEnabled="True"/>
            <Button x:Name="StopMonitorButton" Content="停止監控" Width="120" Height="35" FontSize="14" Margin="10,0,0,0" Click="StopMonitorButton_Click" IsEnabled="False"/>
            <Button x:Name="StartButton" Content="開始檢測" Width="120" Height="35" FontSize="14" Margin="10,0,0,0" Click="StartButton_Click" IsEnabled="False" Visibility="Collapsed"/>
            <Button x:Name="StopButton" Content="停止檢測" Width="120" Height="35" FontSize="14" Margin="10,0,0,0" Click="StopButton_Click" IsEnabled="False" Visibility="Collapsed"/>
            <Button x:Name="ProcessSingleFileButton" Content="處理單文件" Width="120" Height="35" FontSize="14" Margin="10,0,0,0" Click="ProcessSingleFileButton_Click" IsEnabled="False" Visibility="Collapsed"/>
            <Button x:Name="ProcessBatchButton" Content="批量處理" Width="120" Height="35" FontSize="14" Margin="10,0,0,0" Click="ProcessBatchButton_Click" IsEnabled="False" Visibility="Collapsed"/>
            <Button x:Name="OpenOutputFolderButton" Content="打開輸出文件夾" Width="150" Height="35" FontSize="14" Margin="10,0,0,0" Click="OpenOutputFolderButton_Click"/>
        </StackPanel>

        <!-- 主内容区域 -->
        <Grid Grid.Row="2" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="300" MinWidth="200"/>
            </Grid.ColumnDefinitions>

            <!-- 图片显示区域 -->
            <GroupBox Grid.Column="0" Header="檢測結果預覽" Margin="0,0,10,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <ScrollViewer x:Name="ImageScrollViewer" 
                                  Grid.Row="0"
                                  HorizontalScrollBarVisibility="Auto" 
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalContentAlignment="Center"
                                  VerticalContentAlignment="Center">
                        <Viewbox x:Name="ImageViewbox" 
                                Stretch="Uniform"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                            <skia:SKElement x:Name="ResultImageElement"
                                           PaintSurface="ResultImageElement_PaintSurface"/>
                        </Viewbox>
                    </ScrollViewer>
                    
                    <TextBlock x:Name="NoImageText" 
                              Grid.Row="0"
                              Text="暫無圖片顯示" 
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Center"
                              FontSize="18"
                              Foreground="Gray"
                              Visibility="Visible"/>
                    
                    <!-- 图片切换控制栏 -->
                    <StackPanel x:Name="ImageControlPanel"
                                Grid.Row="1" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="0,10,0,0"
                                Visibility="Collapsed">
                        <Button x:Name="PreviousImageButton" 
                                Content="◀ 上一張" 
                                Width="100" 
                                Height="30"
                                Margin="0,0,10,0"
                                Click="PreviousImageButton_Click"
                                IsEnabled="False"/>
                        <TextBlock x:Name="ImageCounterText" 
                                  Text="0 / 0" 
                                  VerticalAlignment="Center"
                                  Margin="0,0,10,0"
                                  FontSize="14"
                                  FontWeight="Bold"
                                  MinWidth="80"
                                  TextAlignment="Center"/>
                        <Button x:Name="NextImageButton" 
                                Content="下一張 ▶" 
                                Width="100" 
                                Height="30"
                                Click="NextImageButton_Click"
                                IsEnabled="False"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- 可拖曳的分隔線 -->
            <GridSplitter Grid.Column="1" 
                         HorizontalAlignment="Stretch" 
                         VerticalAlignment="Stretch"
                         Background="LightGray"
                         ShowsPreview="False"
                         Width="5"
                         Cursor="SizeWE"/>
            
            <!-- 右侧信息面板 -->
            <GroupBox Grid.Column="2" Header="信息">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 统计信息 -->
                    <GroupBox Grid.Row="0" Header="統計信息" Margin="0,0,0,10">
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Margin="0,0,0,10">
                                <Run Text="總處理數:" FontWeight="Bold"/>
                                <Run x:Name="TotalCountText" Text="0"/>
                            </TextBlock>
                            
                            <!-- 大的統計方框 -->
                            <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="2" CornerRadius="5" Padding="15" Background="#F5F5F5">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- NG 顯示 -->
                                    <Border Grid.Row="0" Grid.Column="0" BorderBrush="Red" BorderThickness="2" CornerRadius="5" Padding="10" Margin="5" Background="#FFE6E6">
                                        <StackPanel>
                                            <TextBlock Text="NG" FontSize="24" FontWeight="Bold" Foreground="Red" HorizontalAlignment="Center"/>
                                            <TextBlock x:Name="NgCountText" Text="0" FontSize="36" FontWeight="Bold" Foreground="Red" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                            <TextBlock Text="(檢測到目標)" FontSize="12" Foreground="Red" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- OK 顯示 -->
                                    <Border Grid.Row="0" Grid.Column="1" BorderBrush="Green" BorderThickness="2" CornerRadius="5" Padding="10" Margin="5" Background="#E6FFE6">
                                        <StackPanel>
                                            <TextBlock Text="OK" FontSize="24" FontWeight="Bold" Foreground="Green" HorizontalAlignment="Center"/>
                                            <TextBlock x:Name="OkCountText" Text="0" FontSize="36" FontWeight="Bold" Foreground="Green" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                            <TextBlock Text="(未檢測到目標)" FontSize="12" Foreground="Green" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- 良率顯示 -->
                                    <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" BorderBrush="Blue" BorderThickness="2" CornerRadius="5" Padding="10" Margin="5" Background="#E6F3FF">
                                        <StackPanel>
                                            <TextBlock Text="良率" FontSize="24" FontWeight="Bold" Foreground="Blue" HorizontalAlignment="Center"/>
                                            <TextBlock x:Name="YieldRateText" Text="0.00%" FontSize="48" FontWeight="Bold" Foreground="Blue" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                            
                            <StackPanel Grid.Row="2" Margin="0,10,0,0">
                                <TextBlock Margin="0,5,0,0">
                                    <Run Text="當前料號:" FontWeight="Bold"/>
                                    <Run x:Name="CurrentMaterialText" Text="無"/>
                                </TextBlock>
                                <TextBlock Margin="0,5,0,0">
                                    <Run Text="當前文件:" FontWeight="Bold"/>
                                    <Run x:Name="CurrentFileText" Text="無"/>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- 进度条 -->
                    <GroupBox x:Name="ProgressGroupBox" Grid.Row="1" Header="處理進度" Margin="0,0,0,10" Visibility="Collapsed">
                        <StackPanel Margin="5">
                            <ProgressBar x:Name="ProgressBar" Height="20" Minimum="0" Maximum="100" Value="0"/>
                            <TextBlock x:Name="ProgressText" Text="0 / 0" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            <TextBlock Margin="0,5,0,0">
                                <Run Text="處理速度:" FontWeight="Bold"/>
                                <Run x:Name="ProcessingSpeedText" Text="--"/>
                            </TextBlock>
                        </StackPanel>
                    </GroupBox>

                    <!-- 日志输出 -->
                    <GroupBox Grid.Row="2" Header="日誌">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <TextBox x:Name="LogTextBox" 
                                    IsReadOnly="True" 
                                    TextWrapping="Wrap"
                                    VerticalScrollBarVisibility="Auto"
                                    Background="#1E1E1E"
                                    Foreground="#D4D4D4"
                                    FontFamily="Consolas"
                                    FontSize="11"/>
                        </ScrollViewer>
                    </GroupBox>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- 状态栏 -->
        <StatusBar Grid.Row="3" Height="25" Margin="0,0,0,10">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="就緒"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="MonitorStatusText" Text="監控狀態: 未啟動" Foreground="Gray"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>

